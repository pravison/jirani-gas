{% extends 'business/main.html' %}
{% load static %}
{% load humanize%}
{% block title %} Edit {% endblock%}
{% block content %}

<main id="main" class="main">
    {% if messages %}
        {% for message in messages %}
          <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
    
    
        {% endfor %}
    {% endif %}
    
        <div class="pagetitle">
          <h1>Add Loyalty Points</h1>
          <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{% url 'profile' %}">Profile</a></li>
              <li class="breadcrumb-item"><a href="{% url 'all_customers' %}">Customers</a></li>
              <li class="breadcrumb-item"><a href="{% url 'all_loyalty_points' %}">Loyalty Points</a></li>
            </ol>
          </nav>
        </div><!-- End Page Title -->
    
        <section class="section">
          <div class="row">
            <div class="col-lg-12">
    
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Add</h5>
    
                  {% if form.errors or form.non_field_errors %}
                      <div class="mb-3 p-6 bg-red-100 rounded-xl">
                          {% for field in form %}
                              {{ field.errors }}
                          {% endfor %}
    
                          {{ form.non_field_errors }}
                      </div>
                  {% endif %}
    
                  <!-- General Form Elements -->
                  <form method="POST", action="{% url 'add_loyalty_points_to_customer' %}">
                    {% csrf_token %}
                    {% if form.errors %}
                      <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        Your Form Has Errors
                        {% for field in form %}
                          {% if field.errors %}
                            {{ field.errors }}
                          {% endif %}
                        {% endfor %}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                    {% endif %}
    
                    <div class="row mb-3">
                        <div class="col-sm-10 justify-content-center">
                            <select class="form-control" name="category" placeholder="Select Coupone Type" required>
                                <option value="">Select Loyalty Category</option>
                                {% for category in loyalty_categories %}
                                <option value="{{category.category}}">{{category.category}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-10 justify-content-center">
                          <input class="form-control" name="purchase_value" type="number" value="" placeholder="Value e.g purchase value or refferal sales values or  number of visits or number of friends brought" required/>
                        </div>
                        <div class="alert alert-warning alert-dismissible fade show mt-2" role="alert">
                         enter value that corresponds with the loyalty category selected at the top
                          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                          value stands for either  purchase value or refferal sales values or  number of visits or number of friends brought to the store
                          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    </div>

                    <div class="input-group mb-3">
                      <span class="input-group-text" id="basic-addon1">+254</span>
                      <input type="number" name="phone_number" class="form-control" placeholder="ex.740562740 (customer phone number)" required aria-describedby="basic-addon1">
                    </div>
    
                
                    <div class="row mb-3">
                      <div class="col-sm-10 justify-content-center">
                        <button type="submit" class="btn btn-primary " id="RegisteringAccount">Save</button>
                      </div>
                    </div>
    
                  </form><!-- End General Form Elements -->
    
                </div>
              </div>
    
            </div>
          </div>
        </section>
    
      </main><!-- End #main -->
    
      <script>
        src="https://code.jquery.com/jquery-3.6.0.min.js"
      </script>
      <script>
        $(document).ready(function(){
          $('.autocomplete').autocomplete(
            {
              source:'/customer-autocomplete/',
            }
          );
        });
      </script>
      <script>
        // Add an event listener to the form submission
        document.addEventListener('DOMContentLoaded', function () {
            const loginButton = document.getElementById('RegisteringAccount');
            const form = loginButton.closest('form'); // Find the closest form element
    
            if (form) {
                form.addEventListener('submit', function () {
                    // Disable the button
                    loginButton.disabled = true;
    
                    // Update the button text
                    loginButton.textContent = "adding points to customer...";
                });
            }
        });
      </script>
{% endblock %}